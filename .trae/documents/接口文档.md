# 智教魔方 API 接口文档

## 项目概述

智教魔方是一个基于 AgentScope 框架的多智能体 AI 教育系统，专为广东省中小学设计。系统采用无状态架构，提供个性化的 AI 教育服务。

## 系统特性

* **无状态架构**: 所有会话信息由客户端维护，服务端不存储状态

* **多智能体协作**: 包含专家、助教、同伴三种智能体角色

* **个性化学习**: 基于 VARK 学习风格和认知负荷的内容适配

* **智能路由**: 根据用户输入智能选择合适的智能体回应

## API 接口列表

### 1. 智能体对话接口

**接口路径：** `POST /api/v1/agent/chat`\
**功能描述：** 与专家、助教、同伴三类智能体进行对话交流，根据学习上下文提供个性化回复

#### 请求参数

```json
{
  "message": "请解释一下牛顿第一定律",
  "agent_type": "expert",
  "context": {
    "user_id": "user123",
    "session_id": "session456",
    "learning_style": {
      "visual": 0.3,
      "auditory": 0.2,
      "reading": 0.3,
      "kinesthetic": 0.2
    },
    "cognitive_state": {
      "cognitive_load": 0.6,
      "attention_level": 0.8,
      "comprehension_rate": 0.7,
      "learning_progress": 0.5
    },
    "current_topic": "物理学基础",
    "difficulty_level": 3,
    "learning_history": ["力学基础", "运动学"]
  }
}
```

#### 响应结果

```json
{
  "success": true,
  "message": "对话成功",
  "timestamp": "2025-08-12T10:30:00Z",
  "agent_type": "expert",
  "response": "牛顿第一定律，也称为惯性定律，表述为：任何物体都要保持匀速直线运动或静止状态，直到外力迫使它改变运动状态为止...",
  "suggestions": [
    "深入研究相关理论背景",
    "查阅权威学术资料",
    "尝试从多个角度分析问题"
  ]
}
```

#### 参数说明

* `message`: 用户消息内容（必填）

* `agent_type`: 智能体类型，可选值：`expert`（专家）、`assistant`（助教）、`peer`（同伴）

* `context`: 学习上下文（可选），包含用户学习风格、认知状态等信息

***

### 2. 个性化内容生成接口

**接口路径：** `POST /api/v1/content/personalized`\
**功能描述：** 根据学习者的学习风格和认知状态，生成个性化的学习内容

#### 请求参数

```json
{
  "topic": "二次函数",
  "content_type": "explanation",
  "context": {
    "user_id": "user123",
    "session_id": "session456",
    "learning_style": {
      "visual": 0.4,
      "auditory": 0.2,
      "reading": 0.2,
      "kinesthetic": 0.2
    },
    "cognitive_state": {
      "cognitive_load": 0.5,
      "attention_level": 0.9,
      "comprehension_rate": 0.8,
      "learning_progress": 0.6
    },
    "current_topic": "数学函数",
    "difficulty_level": 2
  }
}
```

#### 响应结果

```json
{
  "success": true,
  "message": "内容生成成功",
  "timestamp": "2025-08-12T10:30:00Z",
  "data": {
    "content": "二次函数是形如 f(x) = ax² + bx + c 的函数，其中 a ≠ 0。让我们通过图像来理解...",
    "content_type": "explanation",
    "difficulty_level": 2,
    "learning_style_match": {
      "visual": 0.9,
      "auditory": 0.3,
      "reading": 0.7,
      "kinesthetic": 0.4
    }
  }
}
```

#### 参数说明

* `topic`: 学习主题（必填）

* `content_type`: 内容类型，可选值：`explanation`（解释）、`exercise`（练习）、`example`（示例）

* `context`: 学习上下文（必填）

***

### 3. 学习路径生成接口

**接口路径：** `POST /api/v1/learning/path`\
**功能描述：** 基于学习者特征和目标技能，生成个性化的学习路径

#### 请求参数

```json
{
  "subject": "数学",
  "target_skills": ["代数运算", "几何证明", "函数分析"],
  "context": {
    "user_id": "user123",
    "session_id": "session456",
    "learning_style": {
      "visual": 0.3,
      "auditory": 0.3,
      "reading": 0.2,
      "kinesthetic": 0.2
    },
    "cognitive_state": {
      "cognitive_load": 0.4,
      "attention_level": 0.8,
      "comprehension_rate": 0.7,
      "learning_progress": 0.3
    },
    "difficulty_level": 2
  }
}
```

#### 响应结果

```json
{
  "success": true,
  "message": "学习路径生成成功",
  "timestamp": "2025-08-12T10:30:00Z",
  "data": {
    "path_id": "path_789",
    "steps": [
      {
        "step_id": 1,
        "title": "基础代数概念",
        "description": "学习变量、常数、代数式的基本概念",
        "estimated_time": 30,
        "resources": ["视频教程", "练习题"]
      },
      {
        "step_id": 2,
        "title": "代数运算规则",
        "description": "掌握加减乘除运算法则",
        "estimated_time": 45,
        "resources": ["互动练习", "实例分析"]
      }
    ],
    "estimated_duration": 180,
    "difficulty_progression": [1, 2, 3]
  }
}
```

#### 参数说明

* `subject`: 学科名称（必填）

* `target_skills`: 目标技能列表（必填，最多10个）

* `context`: 学习上下文（必填）

***

### 4. 多智能体会话初始化接口

**接口路径：** `POST /api/v1/chat/session/init`\
**功能描述：** 初始化深度学习模式的多智能体聊天会话，由专家、助教、同伴智能体开场

#### 请求参数

无需参数

#### 响应结果

```json
{
  "success": true,
  "message": "会话初始化成功",
  "timestamp": "2025-08-12T10:30:00Z",
  "session_id": "uuid-string",
  "initial_history": [
    {
      "role": "ExpertAgent",
      "content": "你好，我是你的专家智能体..."
    },
    {
      "role": "AssistantAgent", 
      "content": "你好，我是你的助教智能体..."
    },
    {
      "role": "CompanionAgent",
      "content": "你好，我是你的同伴智能体..."
    }
  ],
  "opening_remarks": [
    {
      "agent_name": "ExpertAgent",
      "content": "你好，我是你的专家智能体..."
    }
  ]
}
```

### 5. 多智能体协作聊天接口

**接口路径：** `POST /api/v1/chat/collaborate`\
**功能描述：** 在深度学习模式下进行协作式聊天，支持单轮响应和多轮自动协作两种模式，系统根据对话历史动态选择最合适的智能体回应

#### 请求参数

```json
{
  "session_id": "uuid-string",
  "history": [
    {
      "role": "user|ExpertAgent|AssistantAgent|CompanionAgent",
      "content": "string"
    }
  ],
  "user_message": {
    "role": "user",
    "content": "string"
  },
  "auto_config": {
    "enabled": false,
    "max_rounds": 5,
    "continue_on_user_input": false,
    "stop_keywords": ["停止", "暂停", "结束"]
  }
}
```

#### 参数说明

* `session_id`: 会话标识符（必填）

* `history`: 完整对话历史（必填），包含用户和智能体的所有消息

* `user_message`: 用户的最新消息（**可选**），未提供时系统将基于history继续协作

* `auto_config`: 自动多轮协作配置（可选），控制多轮协作行为

  * `enabled`: 是否启用自动多轮协作模式，默认为 `false`

  * `max_rounds`: 自动协作轮次上限，默认为 `5`，范围 1-10

  * `continue_on_user_input`: 用户介入后是否继续自动协作，默认为 `false`

  * `stop_keywords`: 触发停止的关键词数组，默认为 `["停止", "暂停", "结束"]`

#### 兼容性说明

**user\_message 字段兼容性更新**

为了提升API的灵活性和向后兼容性，`user_message` 字段已调整为可选字段：

* **显式模式**: 提供 `user_message` 字段时，系统将优先处理该消息

* **回退模式**: 未提供 `user_message` 时，系统会从 `history` 中提取最近的用户消息继续协作

* **错误处理**: 当 `history` 和 `user_message` 均缺失时，返回 422 错误提示

**调用方式**:

1. **传统方式**: 同时提供 `history` 和 `user_message`（完全向后兼容）
2. **简化方式**: 仅提供 `history`，系统自动从历史中推进协作
3. **多轮模式**: 结合 `auto_config` 实现自动多轮协作

#### 协作模式说明

**单轮模式（默认）：** `auto_config.enabled = false`

* 系统选择一个最合适的智能体响应用户最新消息

* 返回单个智能体的回复

* 保持现有API调用方式的完全兼容

**多轮自动协作模式：** `auto_config.enabled = true`

* **固定顺序阶段：** 首先按"专家→助教→同伴"固定顺序各发言一轮

* **动态路由阶段：** 固定阶段完成后，由路由智能体根据对话上下文智能选择下一个发言者

* **用户介入控制：** `continue_on_user_input` 控制用户发言后是否继续自动模式

* **智能停止：** 支持关键词停止和路由智能体主动结束对话

#### 示例一：单轮协作（默认模式）

```json
{
  "session_id": "uuid-string",
  "history": [
    {"role": "user", "content": "什么是牛顿第一定律？"}
  ]
}
```

#### 示例二：多轮自动协作

```json
{
  "session_id": "uuid-string",
  "history": [
    {"role": "user", "content": "我想深入学习二次函数"}
  ],
  "auto_config": {
    "enabled": true,
    "max_rounds": 8,
    "continue_on_user_input": true,
    "stop_keywords": ["暂停", "停止", "先到这"]
  }
}
```

#### 响应结果

```json
{
  "success": true,
  "message": "协作响应成功",
  "timestamp": "2025-08-12T10:30:00Z",
  "agent_responses": [
    {"role": "ExpertAgent", "content": "string"},
    {"role": "AssistantAgent", "content": "string"},
    {"role": "CompanionAgent", "content": "string"}
  ],
  "updated_history": [
    {"role": "user", "content": "string"},
    {"role": "ExpertAgent", "content": "string"}
  ]
}
```

#### 停止机制说明

* 路由智能体可直接返回 {"agent": "STOP", "reason": "对话已完成"} 来结束自动发言。

* 系统会对响应内容与 stop\_keywords 进行大小写与空白字符规范化匹配，命中即停止。

* 固定阶段为“专家→助教→同伴”，完成后进入动态路由阶段。

* 路由层已加入“避免同一智能体连续发言超过2轮”的指导规则；如必须连续发言，需在reason中说明原因。

***

### 6. 学习分析接口

**接口路径：** `POST /api/v1/analytics/learning`\
**功能描述：** 分析学习者的学习数据，提供多维度分析和改进建议

#### 请求参数

```json
{
  "user_id": "user123",
  "time_range": {
    "start_date": "2025-08-01",
    "end_date": "2025-08-12"
  },
  "analysis_type": "progress"
}
```

#### 响应结果

```json
{
  "success": true,
  "message": "学习分析完成",
  "timestamp": "2025-08-12T10:30:00Z",
  "data": {
    "analysis_type": "progress",
    "metrics": {
      "completion_rate": 0.75,
      "average_score": 0.82,
      "study_time": 480,
      "topics_covered": 12
    },
    "insights": [
      "学习进度良好，保持当前节奏",
      "在几何部分表现优秀",
      "代数运算需要加强练习"
    ],
    "recommendations": [
      "增加代数练习时间",
      "尝试更多几何应用题",
      "定期复习已学内容"
    ]
  }
}
```

#### 参数说明

* `user_id`: 用户ID（必填）

* `time_range`: 分析时间范围（可选）

* `analysis_type`: 分析类型，可选值：`progress`（进度）、`performance`（表现）、`behavior`（行为）

***

### 7. 智能问答接口

**接口路径：** `POST /api/v1/qa/intelligent`\
**功能描述：** 提供智能化的问题解答服务，根据问题类型选择合适的智能体

#### 请求参数

```json
{
  "question": "为什么水的沸点是100摄氏度？",
  "subject": "物理",
  "context": {
    "user_id": "user123",
    "session_id": "session456",
    "learning_style": {
      "visual": 0.3,
      "auditory": 0.3,
      "reading": 0.2,
      "kinesthetic": 0.2
    },
    "cognitive_state": {
      "cognitive_load": 0.5,
      "attention_level": 0.8,
      "comprehension_rate": 0.7,
      "learning_progress": 0.6
    },
    "current_topic": "热力学"
  }
}
```

#### 响应结果

```json
{
  "success": true,
  "message": "问答成功",
  "timestamp": "2025-08-12T10:30:00Z",
  "data": {
    "answer": "水的沸点是100摄氏度是在标准大气压（1个大气压）条件下的情况。这是因为...",
    "confidence": 0.9,
    "related_topics": ["基础概念", "实践应用", "进阶学习"],
    "follow_up_questions": [
      "这个概念在实际中如何应用？",
      "有哪些相关的扩展知识？"
    ]
  }
}
```

#### 参数说明

* `question`: 问题内容（必填，至少5个字符）

* `subject`: 学科领域（可选）

* `context`: 学习上下文（可选）

***

### 8. 系统健康检查接口

**接口路径：** `GET /api/v1/system/health`\
**功能描述：** 检查系统各组件的运行状态

#### 请求参数

无需参数

#### 响应结果

```json
{
  "success": true,
  "message": "健康检查完成",
  "timestamp": "2025-08-12T10:30:00Z",
  "version": "1.0.0",
  "status": "健康",
  "components": {
    "agent_manager": "正常",
    "expert_agent": "正常",
    "assistant_agent": "正常",
    "peer_agent": "正常",
    "personalization_service": "正常",
    "deep_learning_service": "正常",
    "analytics_service": "正常"
  }
}
```

***

### 9. 根路径接口

**接口路径：** `GET /`\
**功能描述：** 系统基本信息和状态

#### 请求参数

无需参数

#### 响应结果

```json
{
  "message": "欢迎使用智教魔方 - 广东省中小学AI自学辅导助教系统",
  "version": "1.0.0",
  "docs": "/docs",
  "status": "running"
}
```

## 数据模型定义

### LearningStyleData（学习风格数据）

```json
{
  "visual": 0.25,        // 视觉学习偏好 (0-1)
  "auditory": 0.25,      // 听觉学习偏好 (0-1)
  "reading": 0.25,       // 阅读学习偏好 (0-1)
  "kinesthetic": 0.25    // 动觉学习偏好 (0-1)
}
```

### CognitiveState（认知状态数据）

```json
{
  "cognitive_load": 0.6,      // 认知负荷水平 (0-1)
  "attention_level": 0.8,     // 注意力水平 (0-1)
  "comprehension_rate": 0.7,  // 理解率 (0-1)
  "learning_progress": 0.5    // 学习进度 (0-1)
}
```

### LearningContext（学习上下文）

```json
{
  "user_id": "user123",           // 用户ID
  "session_id": "session456",     // 会话ID
  "learning_style": {},           // 学习风格数据
  "cognitive_state": {},          // 认知状态数据
  "current_topic": "数学",        // 当前学习主题
  "difficulty_level": 3,          // 难度等级 (1-5)
  "learning_history": []          // 学习历史
}
```

## 错误码说明

| 状态码 | 错误类型  | 说明         |
| --- | ----- | ---------- |
| 200 | 成功    | 请求处理成功     |
| 400 | 参数错误  | 请求参数不正确或缺失 |
| 500 | 服务器错误 | 内部服务器错误    |

### 常见错误响应格式

```json
{
  "error": "validation_error",
  "message": "参数验证失败：问题描述过于简短"
}
```

## 使用示例

### JavaScript/TypeScript 示例

```javascript
// 智能体对话示例
const chatWithAgent = async () => {
  const response = await fetch('http://localhost:8000/api/v1/agent/chat', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      message: '请解释一下牛顿第一定律',
      agent_type: 'expert',
      context: {
        user_id: 'user123',
        session_id: 'session456',
        learning_style: {
          visual: 0.3,
          auditory: 0.2,
          reading: 0.3,
          kinesthetic: 0.2
        },
        cognitive_state: {
          cognitive_load: 0.6,
          attention_level: 0.8,
          comprehension_rate: 0.7,
          learning_progress: 0.5
        },
        current_topic: '物理学基础',
        difficulty_level: 3
      }
    })
  });
  
  const data = await response.json();
  console.log(data);
};

// 系统健康检查示例
const checkHealth = async () => {
  const response = await fetch('http://localhost:8000/api/v1/system/health');
  const data = await response.json();
  console.log('系统状态:', data.status);
};
```

### Python 示例

```python
import requests
import json

# 智能问答示例
def ask_question():
    url = 'http://localhost:8000/api/v1/qa/intelligent'
    data = {
        'question': '为什么水的沸点是100摄氏度？',
        'subject': '物理',
        'context': {
            'user_id': 'user123',
            'session_id': 'session456',
            'current_topic': '热力学'
        }
    }
    
    response = requests.post(url, json=data)
    result = response.json()
    print(f"答案: {result['data']['answer']}")
    print(f"置信度: {result['data']['confidence']}")

# 个性化内容生成示例
def generate_content():
    url = 'http://localhost:8000/api/v1/content/personalized'
    data = {
        'topic': '二次函数',
        'content_type': 'explanation',
        'context': {
            'user_id': 'user123',
            'session_id': 'session456',
            'learning_style': {
                'visual': 0.4,
                'auditory': 0.2,
                'reading': 0.2,
                'kinesthetic': 0.2
            },
            'cognitive_state': {
                'cognitive_load': 0.5,
                'attention_level': 0.9,
                'comprehension_rate': 0.8,
                'learning_progress': 0.6
            },
            'difficulty_level': 2
        }
    }
    
    response = requests.post(url, json=data)
    result = response.json()
    print(f"生成内容: {result['data']['content']}")
```

## 注意事项

1. **认证授权**：当前版本暂未实现用户认证，所有接口均可直接访问
2. **请求限制**：建议控制请求频率，避免对系统造成过大压力
3. **数据格式**：所有请求和响应均使用JSON格式
4. **错误处理**：请根据HTTP状态码和响应中的error字段进行错误处理
5. **上下文数据**：学习上下文数据对个性化效果有重要影响，建议尽可能提供完整信息
6. **智能体选择**：不同类型的智能体适合不同场景，expert适合理论问题，assistant适合操作指导，peer适合一般交流

## 更新日志

* **v1.0.0** (2025-08-12)

  * 初始版本发布

  * 实现8个核心API接口

  * 支持多智能体对话

  * 个性化学习功能

  * 学习分析和路径生成

***

**文档更新时间：** 2025-08-15\
**联系方式：** 如有问题请联系开发团队
